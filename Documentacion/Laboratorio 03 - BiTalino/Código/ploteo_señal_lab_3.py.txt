# -*- coding: utf-8 -*-
"""Ploteo Señal Lab 3.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1SYQflwRPs4JzK75RTbL5FVBlHt8CVlvx

# Lectura y graficación de una señal almacenada en un archivo txt
"""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns
import re

"""## Abrimos el archivo txt para ver  el contenido"""

f = open("signalMarcelo.txt","r")
raw_data = f.readline()  # con f.read() leemos todo el contenido
f.close()

raw_data

## Expresion regular para buscar automaticamente el contenido de un numero dentro de un string
x = 100

print(x)

Fs = float(x)
Ts=1/Fs

print(f" Fs={Fs} hz\n Ts={Ts} s")

"""## Leemos el archivo excluyendo las 2 primeras filas del archivo"""

array = np.genfromtxt("./signalStephany.txt", delimiter="\t",skip_header = 3)
array

#Extraemos la columna de la señal
signal = array[:, 5]
signal

#Obtenemos la longitud de la señal
n = len(signal)
n

#Creamos un vector tiempo conociendo n y Ts
t = np.arange(0,n*Ts,Ts)
t

"""## Ploteamos la lectura"""

plt.plot(t, signal, label="señal")      # graficamos la señal
plt.grid(linestyle=":")
plt.xlabel("Tiempo (s)")
plt.ylabel("Amplitud")
plt.legend(loc="upper right")
plt.title("Señal EMG Sara")
plt.show()

"""## La forma de sabes la frecuencia de la señal es viendo en el dominio de la frecuencia"""

N = 2**10                                     # 10 bits, 0-1023

#signal1 = array[:,1]

signal_fft = np.fft.fft(signal, N)           # fft magtinud
signal_fft = np.round(np.abs(signal_fft),3)[0:N//2] # nos quedamos con los componente de la derecha de la FFT
signal_aux = signal_fft/signal_fft.max()     # hallamos el maximo para pasar la magnitud a escala db

with np.errstate(divide='ignore'):
    signal_fft_db = 10*np.log10(signal_aux)  # , out=signal_aux, where=signal_aux >= 0 para evitar division por zero

F_list = np.linspace(0,Fs/2, N//2)
F = np.round(F_list[np.argmax(signal_fft_db)], 1)   # argmax, encuentra el argumento max en un array

plt.plot(F_list, signal_fft_db)  #10 * np.log10(P / Pref) , decibelios
plt.text(F,0, f"{F}Hz")
plt.grid(linestyle=":")
plt.ylabel("Magnitud (db)")
plt.xlabel("Frecuencias (Hz)")
plt.title("FFT en el decibelios señal Sara")
plt.xlim([0,50])
plt.xticks(np.arange(0,50,10))
plt.show()

"""## Segmentación de la Señal

"""

inicio = 9.9
reposo = 11.9
fuerza = 13.9

signal_reposo = signal[int(inicio*Fs):int(reposo*Fs)]
signal_fuerza = signal[int(reposo*Fs):int(fuerza*Fs)]

tiempo_reposo = [i / Fs for i in range(len(signal_reposo))]
tiempo_fuerza = [i / Fs for i in range(len(signal_fuerza))]

plt.figure(figsize=(12, 6))

plt.subplot(311)
plt.plot(tiempo_reposo, signal_reposo)
plt.title('Potencial en Reposo Stephany')
plt.xticks(np.arange(0,2,0.1))
plt.xlabel('Tiempo (s)')
plt.ylabel('Amplitud')

plt.subplot(312)
plt.plot(tiempo_fuerza,signal_fuerza)
plt.title('Potencial en Acción Stephany')
plt.xticks(np.arange(0,2,0.10))
plt.xlabel('Tiempo (s)')
plt.ylabel('Amplitud')



plt.tight_layout()
plt.show()